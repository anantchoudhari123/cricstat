<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cricket Chatbot</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .chat-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 600px;
            height: 80vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .chat-header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .chat-header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .cricket-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 30px;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 15px;
            animation: fadeIn 0.3s ease-in;
        }

        .message.user {
            text-align: right;
        }

        .message.bot {
            text-align: left;
        }

        .message-content {
            display: inline-block;
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.4;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .message.bot .message-content {
            background: white;
            color: #333;
            border: 1px solid #e0e0e0;
        }

        .chat-input {
            display: flex;
            padding: 20px;
            background: white;
            border-top: 1px solid #e0e0e0;
        }

        .input-field {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #ddd;
            border-radius: 25px;
            outline: none;
            font-size: 14px;
            margin-right: 10px;
        }

        .input-field:focus {
            border-color: #667eea;
        }

        .send-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            transition: transform 0.2s;
        }

        .send-button:hover {
            transform: translateY(-2px);
        }

        .send-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .typing-indicator {
            display: none;
            padding: 10px 16px;
            background: white;
            border-radius: 18px;
            margin-bottom: 15px;
            max-width: 80px;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #667eea;
            animation: bounce 1.4s infinite ease-in-out;
        }

        .dot:nth-child(1) { animation-delay: -0.32s; }
        .dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .api-setup {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 13px;
        }

        .api-setup strong {
            color: #856404;
        }

        .quick-questions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .quick-question {
            background: #e3f2fd;
            color: #1976d2;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-question:hover {
            background: #1976d2;
            color: white;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <div class="cricket-icon">üèè</div>
            <h1>Cricket AI Assistant</h1>
            <p>Built to create and resolve controversies</p>
        </div>
        
        <div class="chat-messages" id="messages">
            <div class="api-setup">
                <strong>Ready to Use:</strong> This chatbot is pre-configured with AI capabilities - no setup required! 
                <br>Just start asking your cricket questions and get instant, accurate answers.
            </div>
            
            <div class="message bot">
                <div class="message-content">
                    üèè Hello! I'm your Cricket AI Assistant. I can help you with:
                    <br>‚Ä¢ Live scores and match updates
                    <br>‚Ä¢ Player statistics and records  
                    <br>‚Ä¢ Tournament information (IPL, World Cup, etc.)
                    <br>‚Ä¢ Cricket rules and formats
                    <br>‚Ä¢ Historical data and trivia
                    <br><br>What would you like to know about cricket?
                </div>
            </div>
            
            <div class="quick-questions">
                <div class="quick-question" onclick="sendQuickQuestion('IPL 2025 winner')">IPL 2025 Winner</div>
                <div class="quick-question" onclick="sendQuickQuestion('Virat Kohli stats')">Virat Kohli Stats</div>
                <div class="quick-question" onclick="sendQuickQuestion('Live cricket scores')">Live Scores</div>
                <div class="quick-question" onclick="sendQuickQuestion('Cricket World Cup 2023')">World Cup 2023</div>
            </div>
            
            <div class="typing-indicator" id="typingIndicator">
                <div class="typing-dots">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                </div>
            </div>
        </div>
        
        <div class="chat-input">
            <input type="text" class="input-field" id="messageInput" placeholder="Ask about cricket..." onkeypress="handleKeyPress(event)">
            <button class="send-button" onclick="sendMessage()" id="sendButton">Send</button>
        </div>
    </div>

    <script>
        // Hugging Face API key
        let apiKey = process.env.HUGGINGFACE_API_KEY;
        let conversationHistory = [];

        // Enhanced cricket knowledge base for offline use
        const cricketContext = {
            recent_results: {
                "ipl 2025": "Royal Challengers Bangalore (RCB) won IPL 2025, defeating Punjab Kings in the final at Narendra Modi Stadium, Ahmedabad. This was RCB's maiden IPL title after 18 years.",
                "world cup 2023": "Australia won the ICC Cricket World Cup 2023, defeating India in the final at Narendra Modi Stadium, Ahmedabad.",
                "wpl 2024": "Royal Challengers Bangalore Women won the Women's Premier League 2024.",
                "t20 world cup 2024": "India won the T20 World Cup 2024, defeating South Africa in the final."
            },
            player_stats: {
                "virat kohli": "Virat Kohli has scored over 26,000 international runs across all formats. He holds the record for most centuries in ODI cricket and is considered one of the greatest batsmen of all time.",
                "ms dhoni": "MS Dhoni is former Indian captain known for his finishing ability and wicket-keeping skills. He led India to victory in the 2007 T20 World Cup, 2011 World Cup, and 2013 Champions Trophy.",
                "rohit sharma": "Rohit Sharma is the current Indian cricket team captain and holds the record for highest individual score in ODIs (264). He has hit 3 double centuries in ODIs.",
                "sachin tendulkar": "Sachin Tendulkar is known as the 'Master Blaster' and holds numerous records including most runs in international cricket (34,357) and most centuries (100)."
            },
            live_scores: "For live cricket scores, visit ESPN Cricinfo (cricinfo.com), ICC official website, or download the Cricbuzz app for real-time updates.",
            formats: {
                "test": "Test cricket is the longest format played over 5 days with unlimited overs per side.",
                "odi": "One Day International (ODI) is limited to 50 overs per side and typically lasts 8 hours.",
                "t20": "Twenty20 (T20) is the shortest format with 20 overs per side, lasting about 3 hours."
            }
        };

        function addMessage(content, isUser = false) {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.innerHTML = content;
            
            messageDiv.appendChild(contentDiv);
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function showTyping() {
            document.getElementById('typingIndicator').style.display = 'block';
            document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
        }

        function hideTyping() {
            document.getElementById('typingIndicator').style.display = 'none';
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function sendQuickQuestion(question) {
            document.getElementById('messageInput').value = question;
            sendMessage();
        }

        function getCricketContextualAnswer(question) {
            const lowerQuestion = question.toLowerCase();
            
            // Check for specific cricket queries
            if (lowerQuestion.includes('ipl 2025') && lowerQuestion.includes('winner')) {
                return cricketContext.recent_results["ipl 2025"];
            }
            
            if (lowerQuestion.includes('world cup 2023') && lowerQuestion.includes('winner')) {
                return cricketContext.recent_results["world cup 2023"];
            }
            
            if (lowerQuestion.includes('t20 world cup 2024')) {
                return cricketContext.recent_results["t20 world cup 2024"];
            }
            
            if (lowerQuestion.includes('virat kohli')) {
                return cricketContext.player_stats["virat kohli"];
            }
            
            if (lowerQuestion.includes('ms dhoni') || lowerQuestion.includes('dhoni')) {
                return cricketContext.player_stats["ms dhoni"];
            }
            
            if (lowerQuestion.includes('rohit sharma') || lowerQuestion.includes('rohit')) {
                return cricketContext.player_stats["rohit sharma"];
            }
            
            if (lowerQuestion.includes('sachin tendulkar') || lowerQuestion.includes('sachin')) {
                return cricketContext.player_stats["sachin tendulkar"];
            }
            
            if (lowerQuestion.includes('live score')) {
                return cricketContext.live_scores;
            }
            
            if (lowerQuestion.includes('test cricket') || lowerQuestion.includes('test format')) {
                return cricketContext.formats["test"];
            }
            
            if (lowerQuestion.includes('odi') || lowerQuestion.includes('one day')) {
                return cricketContext.formats["odi"];
            }
            
            if (lowerQuestion.includes('t20') || lowerQuestion.includes('twenty20')) {
                return cricketContext.formats["t20"];
            }
            
            return null;
        }

        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            addMessage(message, true);
            input.value = '';
            
            // Disable send button and show typing
            document.getElementById('sendButton').disabled = true;
            showTyping();
            
            try {
                // First check if we have a contextual cricket answer
                const contextualAnswer = getCricketContextualAnswer(message);
                if (contextualAnswer) {
                    hideTyping();
                    addMessage(`üèè ${contextualAnswer}`);
                    document.getElementById('sendButton').disabled = false;
                    return;
                }
                
                // Build cricket-focused prompt
                const cricketPrompt = `You are a cricket expert AI assistant. Answer this cricket question accurately and concisely: "${message}". 
                
                Focus on:
                - Current cricket news and results
                - Player statistics and records
                - Tournament information
                - Cricket rules and formats
                - Historical cricket data
                
                Keep responses cricket-focused and informative. If it's not about cricket, politely redirect to cricket topics.`;
                
                // Try alternative API endpoint that works with local files
                const response = await fetch('https://api-inference.huggingface.co/models/facebook/blenderbot-400M-distill', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        inputs: cricketPrompt,
                        options: {
                            wait_for_model: true
                        }
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }
                
                const data = await response.json();
                let aiResponse = data[0]?.generated_text || data.generated_text || "I'm having trouble processing that question. Could you try rephrasing it?";
                
                // Clean up the response
                aiResponse = aiResponse.replace(cricketPrompt, '').trim();
                
                // Add cricket emoji and formatting
                if (aiResponse && !aiResponse.includes('üèè')) {
                    aiResponse = `üèè ${aiResponse}`;
                }
                
                hideTyping();
                addMessage(aiResponse);
                
            } catch (error) {
                hideTyping();
                console.error('Error:', error);
                
                // Fallback to contextual responses for common questions
                let fallbackResponse = "I'm having trouble connecting to the AI service. ";
                
                if (message.toLowerCase().includes('ipl 2025') && message.toLowerCase().includes('winner')) {
                    fallbackResponse += "However, I can tell you that Royal Challengers Bangalore (RCB) won IPL 2025, defeating Punjab Kings in the final.";
                } else if (message.toLowerCase().includes('live score')) {
                    fallbackResponse += "For live cricket scores, I recommend checking ESPN Cricinfo or the official ICC website.";
                } else {
                    fallbackResponse += "Please check your internet connection and try again.";
                }
                
                addMessage(`‚ùå ${fallbackResponse}`);
            }
            
            document.getElementById('sendButton').disabled = false;
        }

        // Add some sample interactions on load
        window.addEventListener('load', function() {
            document.getElementById('messageInput').focus();
        });
    </script>
</body>
</html>